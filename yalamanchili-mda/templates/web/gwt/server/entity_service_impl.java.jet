<java:format>
package ${$groupID}.server;


import java.util.HashMap;
import java.util.Properties;

import javax.ejb.EJB;


import ${$groupID}.ejb.GenericServiceLocal;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
<%-- process all addAll relations--%>
<c:iterate select="/XMI/XMI.content/Model/Namespace.ownedElement/Package/Namespace.ownedElement/Association" var="association">
	<c:iterate select="$association/Association.connection" var="association_connection">
		<c:iterate select="$association_connection/AssociationEnd" var="association_connection_end">
			<c:setVariable select="$association_connection_end/AssociationEnd.participant/Class/@xmi.idref" var="association_connection_end_classID" />
		<%-- check is the association is corresponding to the class  --%>
					<c:if test="$association_connection_end_classID = $classID">
					<%-- process only classes with many on source side--%>
					<c:if test="$association_connection_end/AssociationEnd.multiplicity/Multiplicity/Multiplicity.range/MultiplicityRange/@lower = 0">
  					<c:if test="$association_connection_end/AssociationEnd.multiplicity/Multiplicity/Multiplicity.range/MultiplicityRange/@upper = -1">
  					   	<%-- iterate over the iterations ends  --%>
  					  	 <c:iterate select="$association_connection/AssociationEnd" var="association_connection_end2">
  					  	 <%-- process only non composites --%>
  					  	 <c:if test="not($association_connection_end2/@aggregation = 'composite')">
  					  	 <c:setVariable select="$association_connection_end2/AssociationEnd.participant/Class/@xmi.idref" var="association_connection_end_classID2" />
  					  	 	<%-- get the end secondary end with other class  --%>
  					  		 	<c:if test="not($association_connection_end_classID2 = $classID)"> 
  					  		 	<%-- check to see if this is a navigable relation--%>
  					  		 	<c:if test="$association_connection_end/@isNavigable = 'true'">
  					  		 	<%-- iterate throught all the classes to get the other class on the association--%>
  					  		 		<c:iterate select="/XMI/XMI.content/Model/Namespace.ownedElement/Package/Namespace.ownedElement/Class" var="class2">
  					  		 			<c:if test="$class2/@xmi.id = $association_connection_end_classID2"> 
  					  		 			import ${$groupID}.entity.${lower-case($package/@name)}.${$class2/@name};
  					  		 			</c:if> 
  					  		 		</c:iterate>
  					  		 	</c:if>	
  							  	</c:if> 
  							  	</c:if>	
  					 	  </c:iterate>
  					</c:if> 	   
  					</c:if> 	  					 	 				 	  
					</c:if> 										
		</c:iterate>
	</c:iterate>
</c:iterate>

import ${$groupID}.ejb.${$package/@name}.${lower-case($class/@name)}.${$class/@name}ServiceLocal;
import ${$groupID}.entity.${$package/@name}.${$class/@name};

import java.io.Serializable;
import java.lang.reflect.Method;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import javax.persistence.EntityManager;

import org.jboss.seam.annotations.Create;
import org.jboss.seam.annotations.In;
import org.jboss.seam.annotations.Name;
import org.jboss.seam.annotations.remoting.WebRemote;
import info.yalamanchili.gwt.beans.TableObj;
import org.jboss.seam.annotations.remoting.WebRemote;

@Name("${$packageName}.${lower-case($class/@name)}.${$class/@name}Service")
public class ${$class/@name}ServiceImpl implements ${$packageName}.${lower-case($class/@name)}.${$class/@name}Service {


	@In(create = true)
	protected GenericServiceLocal genericServiceBean;

	@In(create = true)
	protected ${$class/@name}ServiceLocal ${lower-case($class/@name)}ServiceBean;
	
	@In(create = true)
	protected EntityManager em;
	
	@Override
	@WebRemote
	public ${$class/@name} create(${$class/@name} entity) {
		return ${lower-case($class/@name)}ServiceBean.create(entity);
	}

	@Override
	@WebRemote
	public void delete(${$class/@name} entity) {
		// TODO Auto-generated method stub

	}

	@Override
	@WebRemote
	public TableObj<${$class/@name}> getTableObj( int start) {
		return ${lower-case($class/@name)}ServiceBean.getTableObj( start);
	}

	@Override
	@WebRemote
	public ${$class/@name} read( Long id) {
		return ${lower-case($class/@name)}ServiceBean.read(id);
	}

	@Override
	@WebRemote
	public ${$class/@name} update(${$class/@name} entity) {
		return ${lower-case($class/@name)}ServiceBean.update(entity);
	}
	
<%-- process all addAll relations--%>	
<c:iterate select="/XMI/XMI.content/Model/Namespace.ownedElement/Package/Namespace.ownedElement/Association" var="association">
	<c:iterate select="$association/Association.connection" var="association_connection">
		<c:iterate select="$association_connection/AssociationEnd" var="association_connection_end">
			<c:setVariable select="$association_connection_end/AssociationEnd.participant/Class/@xmi.idref" var="association_connection_end_classID" />
		<%-- check is the association is corresponding to the class  --%>
					<c:if test="$association_connection_end_classID = $classID">
					<%-- process only classes with many on source side--%>
					<c:if test="$association_connection_end/AssociationEnd.multiplicity/Multiplicity/Multiplicity.range/MultiplicityRange/@lower = 0">
  					<c:if test="$association_connection_end/AssociationEnd.multiplicity/Multiplicity/Multiplicity.range/MultiplicityRange/@upper = -1">
  					   	<%-- iterate over the iterations ends  --%>
  					  	 <c:iterate select="$association_connection/AssociationEnd" var="association_connection_end2">
  					  	 <%-- process only non composites --%>
  					  	 <c:if test="not($association_connection_end2/@aggregation = 'composite')">
  					  	 <c:setVariable select="$association_connection_end2/AssociationEnd.participant/Class/@xmi.idref" var="association_connection_end_classID2" />
  					  	 	<%-- get the end secondary end with other class  --%>
  					  		 	<c:if test="not($association_connection_end_classID2 = $classID)"> 
  					  		 	<%-- check to see if this is a navigable relation--%>
  					  		 	<c:if test="$association_connection_end/@isNavigable = 'true'">
  					  		 	<%-- iterate throught all the classes to get the other class on the association--%>
  					  		 		<c:iterate select="/XMI/XMI.content/Model/Namespace.ownedElement/Package/Namespace.ownedElement/Class" var="class2">
  					  		 			<c:if test="$class2/@xmi.id = $association_connection_end_classID2">
  					  		 			@Override
										@WebRemote
										public void addAll(${$class2/@name} ${lower-case($class2/@name)}, ${$class/@name} ${lower-case($class/@name)},
												List<Long> children) {
											${lower-case($class/@name)}ServiceBean.addAll(${lower-case($class2/@name)}, ${lower-case($class/@name)}, children);
										} 
  					  		 			</c:if> 
  					  		 		</c:iterate>
  					  		 	</c:if>	
  							  	</c:if> 
  							  	</c:if>	
  					 	  </c:iterate>
  					</c:if> 	   
  					</c:if> 	  					 	 				 	  
					</c:if> 										
		</c:iterate>
	</c:iterate>
</c:iterate>	
	
	

	@Override
	@WebRemote
	public List<${$class/@name}> getEntities(${$class/@name} entity) {
		return ${lower-case($class/@name)}ServiceBean.getEntities(entity);
	}

	@Override
	@WebRemote
	public  Map<Long, String> getListBoxValues(String[] columns) {
		return ${lower-case($class/@name)}ServiceBean.getListBoxValues(columns);
	}

	@Override
	@WebRemote
	public <T extends Serializable> List<T> getRelatedEntities(Long entityID,
			String sourceClass, T target) {
		return genericServiceBean.getRelatedEntities(entityID, ${$class/@name}.class,
				target);
	}

	@Override
	@WebRemote
	public List<String> getSuggestionsForName(String name, ${$class/@name} entity) {
		return genericServiceBean.getSuggestionsForName(name, entity);
	}
	
	@Override
	@WebRemote
	public <T extends Serializable> void merge(${$class/@name} entity, T child) {
		 ${lower-case($class/@name)}ServiceBean.merge(entity, child);
	}
	
	
}
</java:format>
